{% extends "base.html" %}
{% block title %}Teacher Dashboard{% endblock %}
{% block content %}
<section class="home-hero">
  <div class="overlay">
    <h1>Welcome, {{ session.username }}</h1>
    <p style="color: white; margin-bottom: 30px;">Teacher Dashboard</p>

    <div class="dashboard-grid">
      <!-- Class Overview -->
      <div class="dashboard-card">
        <div class="card-header teacher">
          <h2>👥 Class Overview</h2>
        </div>
        <div class="card-body">
          <div class="stat-item">
            <span class="stat-label">Total Students</span>
            <span class="stat-value" id="totalStudents">-</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Total Subjects</span>
            <span class="stat-value" id="totalSubjects">-</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Active Homeworks</span>
            <span class="stat-value" id="activeHomeworks">-</span>
          </div>
        </div>
      </div>

      <!-- Attendance Management -->
      <div class="dashboard-card">
        <div class="card-header teacher">
          <h2>📊 Attendance</h2>
        </div>
        <div class="card-body">
          <div class="stat-item">
            <span class="stat-label">Today's Classes</span>
            <span class="stat-value" id="todayClasses">-</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Classes Marked</span>
            <span class="stat-value" id="classesMarked">-</span>
          </div>
          <a href="{{ url_for('store') }}" class="btn" style="margin-top: 15px;">Mark Attendance</a>
          <a href="{{ url_for('view') }}" class="btn btn-secondary" style="margin-top: 10px;">View Records</a>
        </div>
      </div>

      <!-- Homework Management -->
      <div class="dashboard-card">
        <div class="card-header teacher">
          <h2>📝 Homework Status</h2>
        </div>
        <div class="card-body">
          <div class="stat-item">
            <span class="stat-label">Pending Submissions</span>
            <span class="stat-value" id="pendingSubmissions">-</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">To Grade</span>
            <span class="stat-value" id="toGrade">-</span>
          </div>
          <a href="{{ url_for('manage_homework') }}" class="btn" style="margin-top: 15px;">Manage Homework</a>
          <a href="{{ url_for('homework_calendar') }}" class="btn btn-secondary" style="margin-top: 10px;">View Calendar</a>
        </div>
      </div>

      <!-- Student Doubts -->
      <div class="dashboard-card">
        <div class="card-header teacher">
          <h2>💬 Student Doubts</h2>
        </div>
        <div class="card-body">
          <div class="stat-item">
            <span class="stat-label">Unanswered</span>
            <span class="stat-value" id="unansweredDoubts">-</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Total Doubts</span>
            <span class="stat-value" id="totalDoubts">-</span>
          </div>
          <a href="{{ url_for('teacher_doubts_list') }}" class="btn" style="margin-top: 15px;">View All Doubts</a>
        </div>
      </div>
    </div>

    <div class="quick-actions" style="margin-top: 40px;">
      <h2 style="color: white; margin-bottom: 20px;">Quick Actions</h2>
      <div class="cards">
        <a class="card attendance" href="{{ url_for('store') }}">📋 Mark Attendance</a>
        <a class="card homework" href="{{ url_for('manage_homework') }}">➕ Post Homework</a>
        <a class="card project" href="{{ url_for('teacher_analytics') }}">📈 View Analytics</a>
        <a class="card communication" href="{{ url_for('teacher_doubts_list') }}">💬 Answer Doubts</a>
        <a class="card" href="{{ url_for('view') }}">📑 View Records</a>
        <a class="card" href="{{ url_for('individual') }}">🧑‍🎓 Student Reports</a>
      </div>
    </div>
  </div>
</section>

<a href="{{ url_for('logout') }}" class="logout-link">Logout</a>

<script>
document.addEventListener('DOMContentLoaded', async function() {
  try {
    const response = await fetch('/api/teacher/dashboard_stats');
    const data = await response.json();

    if (data.ok) {
      document.getElementById('totalStudents').textContent = data.students.total;
      document.getElementById('totalSubjects').textContent = data.subjects.total;
      document.getElementById('activeHomeworks').textContent = data.homework.active;

      document.getElementById('todayClasses').textContent = data.attendance.today_classes;
      document.getElementById('classesMarked').textContent = data.attendance.marked;

      document.getElementById('pendingSubmissions').textContent = data.homework.pending_submissions;
      document.getElementById('toGrade').textContent = data.homework.to_grade;

      document.getElementById('unansweredDoubts').textContent = data.doubts.unanswered;
      document.getElementById('totalDoubts').textContent = data.doubts.total;
    }
  } catch (error) {
    console.error('Error loading dashboard stats:', error);
  }
});
</script>

<style>
.dashboard-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 20px;
  margin-top: 30px;
}

.dashboard-card {
  background: rgba(255, 255, 255, 0.95);
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 4px 6px rgba(0,0,0,0.1);
}

.card-header {
  padding: 20px;
  color: white;
}

.card-header.teacher {
  background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
}

.card-header h2 {
  margin: 0;
  font-size: 1.3em;
}

.card-body {
  padding: 20px;
}

.stat-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px 0;
  border-bottom: 1px solid #eee;
}

.stat-item:last-of-type {
  border-bottom: none;
}

.stat-label {
  font-weight: 500;
  color: #666;
}

.stat-value {
  font-size: 1.5em;
  font-weight: bold;
  color: #f5576c;
}

.quick-actions .cards {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 15px;
}

.btn-secondary {
  background: #6c757d;
}

.btn-secondary:hover {
  background: #5a6268;
}
</style>
{% endblock %}
